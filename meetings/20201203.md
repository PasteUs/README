# 关于 PasteMe 的现状与未来

# 1. 目前的现状

1. 淡季平均日访问量 2k，旺季日访问量 10k
2. Paste 数量达到 90k
3. Permanents 表是 500 MB 左右

# 2. 存在的需求

## 2.1 凌晨被恶意请求阅后即焚的接口

1. 写了 30 GB 的脏数据到数据库里，导致磁盘占用达到 100%，mysqld crash
2. tcp 流量被阻断，ssh、http 等服务均不可用

### 2.1.1 体现出来的问题

1. 接口没有鉴权
2. 没有限流
3. 没有降级
4. 没有报警
5. 没有熔断

总而言之，就是缺乏一系列自动化的操作以来应对紧急情况。

### 2.2.2 解决方案

1. 添加用户系统，用户注册时设人机和邮箱验证，针对每个用户的日写入量进行限流
2. 增加对接口的监控，如果写入接口的流量增速超过某个阈值时，限流并报警
3. 对磁盘可用空间进行监控，如果磁盘空间快要满的时候发告警
4. 高频访问的 IP 自动拉黑

## 2.2 要求删除 Permanent Paste

很多时候会有小伙伴发邮件说能不能删掉某个 Paste，我都会手动删。

### 2.2.1 解决方案

1. 用户系统上线之后，用户能自主删除自己发的 Paste

## 2.3 Paste ID 复用

一旦拥有删除 Paste 的功能，将会面临有一批 Paste ID 为空的情况，技术上需要考虑如何复用。

# 3. 需要讨论的部分

## 3.1 关于 namespace

用户系统上线之后，用户提交的 Paste 是仍旧在 / 下面，还是说在 /username/ 下面。

## 3.2 关于商业化

这个点需要讨论，我的大致思路是免费用户提供有限的功能，api 不对免费用户开放。可以先集思广益一下。

举例：

1. 免费用户每天上限 x 个，可以花 ¥y 来成为付费用户，提高上限。

# 4. 前端改造

前端可能会由 github pages 承载（hash router）
或者是找一个能够免费托管网站的地方。
https://www.zhihu.com/question/64173754

# 5. 优先级

| 级别 | 需求 | Deadline | 涉及改动 | 责任人 | 
| --- | --- | --- | --- | --- |
| P0+ | 高频访问的 IP 自动 BAN | 12.17 | | lx |
| P0 | 用户系统 | 01.10 | 前/后端 | jhm / bzy |
| P0 | 鉴权 | 01.10 | 后端 | lzl lx |
| P1 | 阅后即焚过期时间 | 01.24 | 后端 | lx |
| P2 | 管理员发布公告 | 01.24 | 前端 | jhm |

